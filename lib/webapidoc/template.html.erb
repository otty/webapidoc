<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Webapidoc for <%= @data["title"] %></title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="in-depth WebAPI documentation for <%= @data["title"] %>">
  <meta name="author" content="the nice guys from <%= @data["title"] %>">

  <!-- SVG version of grayscale filter: desaturate.svg -->
  <svg version="1.1" xmlns="http://www.w3.org/2000/svg" style="display: none;">
    <filter id="grayscale">
      <feColorMatrix type="matrix" values="0.3333 0.3333 0.3333 0 0
            0.3333 0.3333 0.3333 0 0
            0.3333 0.3333 0.3333 0 0
            0  0  0  1 0"/>
    </filter>
  </svg>

  <!-- Use a readable font -->
  <link href='http://fonts.googleapis.com/css?family=Lato:300,400,700' rel='stylesheet' type='text/css'>

  <!-- Le styles -->
  <link href="/documentation/css/webapidoc.css" rel="stylesheet">

  <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
  <!--[if lt IE 9]>
  <script src="/documentation/js/html5.js"></script>
  <![endif]-->

  <!-- Les javascripts -->
  <script src="/documentation/js/jquery.js"></script>
  <script src="/documentation/js/highlight.js"></script>

  <!-- Ace Code Editor -->
  <script src="http://d1n0x3qji82z53.cloudfront.net/src-min-noconflict/ace.js" type="text/javascript" charset="utf-8"></script>

  <!-- Fav and touch icons -->
  <link rel="shortcut icon" href="favicon.ico">
</head>

<body>

<div class="container">
  <div class="row">
    <div class="four columns offset-by-one" id="nav">
      <ul class="nav-list">

        <% @chapters.each do |chapter| %>

          <li class="nav-header <%= "active" if chapter[:name] == @current[:name] %>">
            <a href="/documentation/<%= chapter[:out] %>"><%= chapter[:name] %></a></li>

          <% chapter[:sections].each do |section| %>
            <li class="nav-item level<%= section[:level] %>" >
              <a href="<%= chapter[:out] %>#<%= section[:title].downcase.gsub(/[^\d\w\s]/, "").tr(" ", "_") %>"><%= section[:title] %></a>
            </li>

          <% end %>

        <% end %>

      </ul>
      <p class="version">
        Last update: <%= Date.today.strftime("%e. %B %Y ") %>
      </p>
    </div>
    <!--/span-->
    <div class="thirteen columns offset-by-one" id="content">
      <%= @html %>
    </div>
    <!--/span-->
  </div>
  <!--/row-->

  <footer>
    <p>&copy; <%= @data["title"] %> 2012</p>
  </footer>

</div>

  <!-- enable script highlighting -->
  <script>
    $(document).ready(function() {

      $("#content > pre > code").each( function (idx) {
        var $editor = $(this);
        var id = "editor" + idx;
        var height = $editor.height();

        $editor.attr("id", id)

        /* build editor */
        var editor = ace.edit(id);
        editor.setTheme("ace/theme/tomorrow");
        editor.getSession().setMode("ace/mode/javascript");

        $editor.css("height", ((height+8) + "px"));

        /* build response field */
        var rid = "response" + idx;
        var $response = $('<pre><code>change code to see response...</code></pre>').attr("id", rid).addClass("response");

        $editor.after($response);

        /* bind editor change function for api requests */
        editor.on("change", function(e) {
          console.log(e);

          /* validate json */
          var query = "";

          try {
            query = JSON.stringify($.parseJSON(editor.getValue()));
          }
          catch (err) {
            return;
          }
          var url = "<%= @data['url'] %>";
          $.getJSON(url + '&source=' + encodeURIComponent(query)).complete(function (data) {


            $response.html("<code>" + data.responseText + "</code>");
            hljs.highlightBlock($response[0]);
          });
        });

      })

    });

  </script>

</body>
</html>
